import{_ as A}from"./AuthenticatedLayout-DPyQKLkO.js";import{n as C,k as b,p as S,c as o,o as r,a as _,u as D,m as q,w as f,b as e,F as c,r as B,t as a,x as E,C as u,G as N}from"./app-LayFgEfl.js";import{S as i}from"./sweetalert2.esm.all-B0Dix5B2.js";import"./NavLink-DE2x0Iuc.js";const P={class:"py-12"},U={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},L={class:"bg-white shadow-md sm:rounded-lg p-6"},H={key:0},V={class:"w-full border-collapse border border-gray-300"},Y={class:"py-4 px-5 text-gray-700"},F={class:"py-4 px-5 text-gray-800 font-medium"},G={class:"py-4 px-5 text-gray-800 font-semibold"},M={class:"py-4 px-5"},R={class:"py-4 px-5 text-gray-700"},T={class:"py-4 px-5 text-left"},$=["onClick","disabled"],z={key:0},j={key:1},I={key:0},J={class:"text-gray-600"},K={key:2,class:"text-green-500 font-semibold"},O={key:3,class:"text-gray-600 font-semibold"},Q={key:1,class:"text-center py-6"},se={__name:"AssessmentHistory",setup(W){const h=C(),m=b(h.props.assessments||[]),y=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"No date available",v=n=>{switch(n){case"Mild":return"bg-blue-300 text-gray-700";case"Moderate":return"bg-blue-300 text-gray-700";case"Severe":return"bg-blue-300 text-gray-700";default:return"bg-blue-300 text-gray-700"}},x=S(()=>[...m.value].sort((n,s)=>new Date(s.created_at)-new Date(n.created_at))),p=b(!1),w=async n=>{var t,d;if((await i.fire({title:"Are you sure?",text:"Do you want to request an appointment for this assessment?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, request appointment!"})).isConfirmed)try{if(p.value=!0,(await N.post(route("appointments.request"),{assessment_id:n})).status===200){const g=m.value.find(k=>k.id===n);g?(g.appointment_status="pending",i.fire("Appointment Requested!","Your appointment request has been sent and is pending approval.","success")):(console.error("Assessment not found"),i.fire("Error!","Assessment not found. Please try again.","error"))}else throw new Error("Unexpected response from the server.")}catch(l){console.error("Error requesting appointment:",l),l.response?(console.error("Error response:",l.response),i.fire("Error!",((d=(t=l.response)==null?void 0:t.data)==null?void 0:d.message)||"An unexpected error occurred. Please try again.","error")):(console.error("General error:",l),i.fire("Error!","An unexpected error occurred. Please try again.","error"))}finally{p.value=!1}};return(n,s)=>(r(),o(c,null,[_(D(q),{title:"Assessment History"}),_(A,null,{header:f(()=>s[0]||(s[0]=[e("h2",{class:"text-2xl font-bold leading-tight text-gray-700 dark:text-white"}," Assessment History ",-1)])),default:f(()=>[e("div",P,[e("div",U,[e("div",L,[s[4]||(s[4]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-4"}," Your Past Assessments ",-1)),x.value.length>0?(r(),o("div",H,[e("table",V,[s[2]||(s[2]=e("thead",null,[e("tr",{class:"bg-blue-100 text-gray-800 text-left"},[e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Date"),e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Type"),e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Score"),e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Severity"),e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Impact"),e("th",{scope:"col",class:"py-4 px-5 border-b text-left"},"Appointment Status")])],-1)),e("tbody",null,[(r(!0),o(c,null,B(x.value,t=>(r(),o("tr",{key:t.id,class:"border-b border-gray-300 hover:bg-gray-100 transition"},[e("td",Y,a(y(t.created_at)),1),e("td",F,a(t.assessment_type||"Unknown"),1),e("td",G,a(t.total_score??"N/A"),1),e("td",M,[e("span",{class:E(["px-4 py-2 rounded-lg text-sm font-semibold",v(t.severity)])},a(t.severity||"Unknown"),3)]),e("td",R,a(t.impact??"Not Available"),1),e("td",T,[t.appointment_status==="none"?(r(),o("button",{key:0,onClick:d=>w(t.id),disabled:p.value,class:"bg-blue-500 hover:bg-blue-400 text-white px-4 py-2 rounded-lg transition focus:ring-2 focus:ring-blue-300 disabled:bg-gray-300 disabled:cursor-not-allowed"},[p.value?(r(),o("span",z,"Processing...")):(r(),o("span",j,"Request Appointment"))],8,$)):u("",!0),t.appointment_status==="pending"?(r(),o(c,{key:1},[s[1]||(s[1]=e("span",{class:"text-yellow-500 font-semibold"},"Pending Approval",-1)),t.appointment_date?(r(),o("div",I,[e("span",J,"Scheduled for: "+a(y(t.appointment_date)),1)])):u("",!0)],64)):t.appointment_status==="approved"?(r(),o("span",K," Approved - "+a(new Date(t.appointment_date).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})),1)):t.appointment_status==="completed"?(r(),o("span",O,"Completed")):u("",!0)])]))),128))])])])):(r(),o("div",Q,s[3]||(s[3]=[e("p",{class:"text-gray-700"},"No past assessments found.",-1)])))])])])]),_:1})],64))}};export{se as default};
